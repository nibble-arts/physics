//var gl;
var stage;

function load() {

	stage = new Kinetic.Stage({
		container: 'table',
		width: 1000,
		height: 800
	});

	var layer = new Kinetic.Layer();

	var greenbox = new Kinetic.Rect({
		name: "green",
		x: 200,
		y: 50,
		width: 100,
		height: 50,
		offsetX: 50,
		offsetY: 25,
		fill: "green",
		stroke: "black",
		strikeWidth: 4,
		shadowColor: "black",
		shadowBlur: 10,
		shadowOffset: { x:4,y:4 },
		shadowOpacity: 0.5,
		draggable: true,
    dragBoundFunc: function(pos) {
			excentric(this);

    	return {
    		x: pos.x,
    		y: pos.y,
    	}
    }
	});

	layer.add(greenbox);

	var bluebox = new Kinetic.Rect({
		name: "blue",
		x: 400,
		y: 0,
		width: 100,
		height: 50,
		offsetX: 50,
		offsetY: 25,
		fill: "blue",
		stroke: "black",
		strikeWidth: 4,
		shadowColor: "black",
		shadowBlur: 10,
		shadowOffset: { x:4,y:4 },
		shadowOpacity: 0.5,
		draggable: true,
    dragBoundFunc: function(pos) {
			excentric(this);

    	return {
    		x: pos.x,
    		y: pos.y
    	}
    }
	});

	layer.add(bluebox);
	stage.add(layer);

	greenbox.on("dragend", function () {
		var node = greenbox;

		if (node.speed > 1) {
			var anim = new Kinetic.Animation(function(frame) {
				greenbox.x(greenbox.getPosition().x+vx);
				greenbox.y(greenbox.getPosition().y+vy);
      }, layer);

 			anim.start();
		}
	});


	greenbox.on("click", function () {
		greenbox.moveToTop();
		layer.draw();
	});


	bluebox.on("click", function () {
		bluebox.moveToTop();
		layer.draw();
	});
}

function excentric(node) {
	var oldMouse = {};

	var mouse = stage.getPointerPosition();
	var pos = node.getAbsolutePosition();

	(stage.oldMouse) ? oldMouse = stage.oldMouse:oldMouse=mouse;
	stage.oldMouse = mouse;

	node.vx = mouse.x - oldMouse.x;
	node.vy = mouse.y - oldMouse.y;
	node.speed = Math.round(Math.abs(Math.sqrt(node.vx*node.vx + node.vy*node.vy)));

	node.dx = mouse.x - pos.x;
	node.dy = mouse.y - pos.y;

	node.radius = Math.sqrt(node.dx*node.dx + node.dy*node.dy);
}



